# AI 語音轉文字 & 自動字幕生成工具 v2.0
[![For Windows - Download exe](https://img.shields.io/badge/For%20Windows-Download%20exe-blue?style=for-the-badge&logo=windows)](https://github.com/suyanali/AI_TranslateSRT/releases/download/v2.0/Release_windows_v2.0.rar)    [![For Mac - Download Source Code](https://img.shields.io/badge/For%20Mac-Download%20Source%20Code-blue?style=for-the-badge&logo=apple)](https://github.com/suyanali/AI_TranslateSRT/archive/refs/heads/main.zip)

這是一款基於 Google Gemini API 的圖形化工具，可自動將影片或音訊檔案轉錄為帶有時間軸的 SRT 字幕檔，並支援外語內容翻譯。工具整合了 日誌記錄 與 SRT 轉錄（AI 摘要） 功能，使整個轉錄流程更加自動化且方便追蹤。

本工具的功能是透過 GEMINI CLI、Google AI Studio 與 ChatGPT 共同討論與實作而成。若使用過程中發現 bug，歡迎回報，但也請見諒，修正上可能不一定能即時完成。



## ✨ 功能特色

🎞️ **影音轉字幕**：支援所有 FFmpeg 可轉換的影音格式，自動生成 SRT。

🖥️ **圖形化介面**：無需複雜指令，操作全在視窗中完成。

🎯 **Prompt 動態調整**：可指定最終字幕語言、一行字數，並支援術語/專有名詞對照表（含性別欄位）。支援手動編輯、匯出/匯入，以及大量貼上 (Ctrl+V / Cmd+V)。

⚙️ **參數可調**：可自訂 API Key、Gemini 模型、音訊分段時長等。

📑 **SRT 轉錄摘要**：轉錄完成後，會自動生成摘要報告，快速掌握關鍵事件。

📜 **完整日誌**：自動記錄執行過程並即時顯示。

🔑 **僅支援 Google Gemini API**。

🔄 **恢復轉錄**：中途關閉或只需補跑部分字幕時，可選擇恢復模式，不必全部重跑。

⏩ **局部轉錄**：只針對指定時間段生成字幕。

📂 **僅合併字幕**：可將手動修改過的分段 SRT 再次合併。

---

## 🚀 開始使用
*  本工具提供兩種使用方式，請根據您的作業系統和需求選擇其中一種。
*  📌必要元件：
    *  ffmpeg(ffmpeg.exe或 PATH環境變數皆可)
    *  Google Gemini API Key（可輸入於程式或設於環境變數）

### 💻方式一：Windows 使用者 (快速開始)

此方式最為簡單，推薦給所有 Windows 使用者。

1.  到 [Releases 頁面](https://github.com/suyanali/AI_TranslateSRT/releases) 下載最新的 `Release_windows.zip` 壓縮檔。
2.  解壓縮至任意位置
3.  ⚠️ **確認檔案完整 (非常重要！)**：需包含以下程式並確保兩者在同一資料夾  
    `AI_TranslateSRT.exe` (主程式)  
    `ffmpeg.exe` (音訊處理工具)  
4.  直接雙擊 `AI_TranslateSRT.exe` 即可啟動程式。



### 方式二：從原始碼執行 (開發者 / Mac / Linux 使用者)

(我沒有mac跟linux，所以下面安裝指南是ai寫的)，需安裝 **Python 3.11** 與 **FFmpeg**：

#### 1. 環境設定

*   **安裝 Python 3**：請確保您的系統已安裝 Python 3.11 。您可以從 [Python 官網](https://www.python.org/downloads/) 下載。
*   **安裝 FFmpeg**：請確保您的系統已安裝 FFmpeg，並將其加入到系統的環境變數 (PATH) 中。
    *   **Mac 使用者**可透過 [Homebrew](https://brew.sh/) 輕鬆安裝： `brew install ffmpeg`
    *   **Linux 使用者**可透過包管理器安裝： `sudo apt update && sudo apt install ffmpeg`

#### 2. 下載原始碼

*   您可以 `git clone` 本專案，或從 GitHub 頁面點擊 `Code` -> `Download ZIP` 來下載原始碼，並解壓縮。

#### 3. 安裝 Python 依賴套件

```bash
pip install -r requirements.txt
# 或單獨安裝
pip install google-genai
```

#### 4. 執行程式

在終端機中，繼續使用以下指令來啟動圖形化介面：(` transcribe_pro_gui_v2_84.py` 、`transcribe_pro_v5_branch_04_branch_70.py`請放置同一資料夾裡)

```bash
python transcribe_pro_gui_v2_84.py
```

---



## 📖 介面與操作流程  
![imgur](https://imgur.com/X9svBzP.png)




## **依照圖示數字順序操作**：  

1. 選擇來源的影音檔 
2.   進階設定中選擇要翻譯成的語言，根據要翻譯成的語言填寫一行平均字幕字數(例如 中文為16字元) 
3. 指定翻譯的名稱（例如角色名字、地名、專有名詞）
4.  填入 API Key 
5. 確認使用的gemini api model
6.  按下「開始轉錄」
7. 最後：SRT檢查、看日誌

### 🚀各項解釋：  
1. **選擇來源檔案**
   點擊 **「選擇檔案...」** 按鈕，挑選要轉錄的影片或音訊檔案。
   **影片**：支援 `.mp4`、`.mkv` 等多種格式
   
   **音訊**：支援 `.mp3`、`.wav` 等多種格式
   ◆原則上只要 FFmpeg 能轉檔的格式都可使用。
   
2. **設定轉錄與翻譯規則**

   * **主要規則**
     這裡是給 AI 的核心指令，通常不需要修改。
     ⚠️ 請勿刪除或更動大括號 `{}` 內的佔位符（如 `{max_chars}`、`{language}`、`{fifth_priority}`、`{sixth_priority}`、`{seventh_priority}`、`{final_instruction}`），否則可能導致程式無法正常運作。

   * **進階設定**  
     
     * **目標語言**：設定最終字幕要輸出的語言，例如「繁體中文」或「英文」。
     * **單行字數上限**：中文建議 **16 個字元**，英文建議 **42 個字元**。
     * **人名或術語對應表**：
       * 如果影片中有特定專有名詞或人名，可以在此設定對照表（如 `Alex = 亞歷克斯 = 男`），AI 會優先套用。
       * 支援 **智慧大量貼上**，可匯出與匯入（僅支援 UTF-8 編碼的 `.txt`）。  
         ![imgur](https://imgur.com/jo1e6iA.jpg)
       * 貼上方式：  
         * 直接在文字編輯器照範例輸入，存成 `.txt` 再匯入  
             ![imgur](https://imgur.com/9kPfp9k.jpg)
         * 或將對應表複製 → 在術語表區域貼上（支援大量貼上）          
       * 建議將 **全名、姓、名** 分別建檔，以提高翻譯一致性。
       * 匯入時可選擇 **覆蓋** 或 **增量新增**。
           ![imgur](https://imgur.com/XZCELmF.jpg)
     
       * 也可以請 AI 協助建立，例如在 perplexity.ai 輸入 prompt：
         ```
         音樂劇「XXXXX」中所有角色、演員、專有名詞的 {原始語言} 名字 
         及其常見 {目標語言} 翻譯與性別對照表。
         請用以下格式整理：Alex = 亞歷克斯 = 男
         ```

3. 參數說明  

   *   **API Key**：您的 Google API 金鑰。若留空，，程式會嘗試從系統環境變數讀取。  

   *   **模型名稱**：使用的 Gemini 模型，預設為 `models/gemini-2.5-pro`。可建議至少使用 `gemini-2.5-pro` 或` gemini-2.5-flash`，其中 2.5-pro 效果最佳，低階模型品質較差。  

   *   **分段時長 (秒)**：影片會被切分為小段處理。預設為 600 秒（10 分鐘）  
      ⚠️ 若設定過長，語音轉文字容易失敗，建議保持預設值。  
   *   **暫存資料夾**：用於存放處理中的音訊片段，預設會在主程式資料夾內建立 temp 資料夾。**並且後續不會自動刪除裡面的分割檔**，當使用者確定不會再次使用時可自行刪除。

---
**進階參數**：  (一般無須調整，詳細功用可看 [SRT correction rules.md](detailed instruction manual/SRT correction rules.md)、[GUI advanced.md](detailed instruction manual/GUI advanced.md)）

   *   **修正閾值**：觸發自動重試的品質標準，數字越小，標準越嚴格。
   *   **重疊容忍 (秒)**：允許相鄰字幕在時間上的重疊秒數，用於處理合唱或對話緊湊的情境。設為負數 (例如 -1) 可完全關閉重疊偵測。
   *    **結尾空白閥值**：偵測分割音檔在結尾是否出現長時間無字幕/靜音的異常，超過此秒數即判定為可疑截斷。設為 0 停用。
   *    **連續空值終止閥值**：連續收到 API 空白回應(empty response)達到此次數，就自動中止任務。設為 0 停用。
   *    **併發數**：同時處理的轉錄任務數量，數字越大速度越快，但會增加電腦負載與 API 壓力，預設為1。
   *    **每分鐘請求數**：限限制 API 的每分鐘請求次數，用於避免觸發限流，數字越小越安全但速度會變慢，可依官方限制調整，預設為 3

---
*    **匯出設定檔/匯入設定檔**：可將參數保存成設定檔，下次使用時直接匯入即可。此外，每次開啟程式會自動生成`config.json`在主程式資料夾裡，供下次可直接匯入上次填寫參數。**⚠️ 其中json檔會包含填寫於介面上的 API Key，請勿隨意分享！**


4. **開始轉錄與查看日誌**：設定完成後，點擊 **開始轉錄** 按鈕。下方的「即時日誌」視視窗會顯示詳細執行過程，並自動存檔。  
⏱️ 時間參考：  
以筆者經驗，2.5~3 小時的影片（不含 FFmpeg 轉檔時間），生成 SRT 約需 37 ~ 65 分鐘，實際時間取決於是否觸發重試機制（修正閾值）  
*    **📂未完成的任務**: temp 資料夾內已有與來源檔案一致的分段 mp3 或 srt，程式會自動觸發：
*    	**「恢復任務」**：僅補齊缺少的音檔或字幕檔
*    	**「重新開始」**：刪除既有的與來源檔案一致分段時長的mp3與srt後再重新切分與轉錄。
![imgur](https://imgur.com/Gk5bW3K.jpg)  
5. **「僅重新合併 SRT」模式**：此模式僅會合併與來源檔名、分段長度一致的 SRT 檔案，不會重新轉錄。



## 📁 關於輸出檔案

轉錄成功後，所有相關檔案都會儲存在您**主程式所在的資料夾**下：

*   `[您的影片名稱].srt`：**最終的字幕成品！**
*   `[您的影片名稱]_日誌_[時間].txt`：本次執行的完整文字日誌。
*   `[您的影片名稱]_SRT轉錄情況_[時間].txt`：由 AI 分析日誌後生成的專注於srt生成情況的摘要報告。


### 📝【重要】最終字幕的品質檢查

雖然本程式內建了自動校正機制，但 AI 的輸出仍可能存在瑕疵。為了確保最佳品質，**強烈建議**您在轉錄完成後進行快速檢查，並搭配 AI 智慧摘要檔案：

```
[您的影片名稱]_SRT轉錄情況_[時間].txt
```

#### 1. 檢視 SRT 轉錄情況

重點關注以下訊息：

* `重試` → 是否最終成功？
* `API 回應空白` → 是否連續發生？之後該段字幕是否成功生成？
* `SRT 截斷警告` → 當最後一句字幕距離音檔結尾超過 60 秒時會觸發。
  * 請確認這段是否確實沒有對話，或是 AI 遺漏了字幕。
  * （可透過調整 `結尾空白閥值` 修改判斷秒數）

#### 2. 其他檢查要點
* 是否有 **大量亂碼** 或 **不相關的文字**？
* 是否有字幕 **未翻譯成目標語言**？
* 建議：
  * 使用字幕編輯軟體（如 Subtitle Edit）打開最終成品 `[您的影片名稱].srt`，軟體會自動標記異常片段（上底色）。
  * 播放影片並搭配字幕，每隔 5 分鐘前後跳轉檢查（例如 3 分鐘、8 分鐘），快速確認是否有整段遺漏。

#### 3. 問題處理方式

* 若某個分段字幕內容嚴重錯誤：
  1. **手動刪除**該分段檔案（`_chunk_xxx.srt` & `raw.txt`）。
  2. 重新對原始影片執行轉錄 → 程式會跳過已完成的部分，只處理缺少的段落，節省時間。
* 若問題僅限於小錯誤：
  * 可直接手動編輯該分段字幕檔，然後使用「**僅重新合併 SRT**」模式，讓程式自動合併。


## 🛠️ 工具箱 (點箭頭展開介面)

![imgur](https://imgur.com/5NhmJ64.jpg)

1. 🎯 **局部轉錄**
   當發現某些時間區段沒有轉錄出文字，或想重跑特定片段時，可以使用局部轉錄功能。  
   * 在 **temp 資料夾** 生成的字幕檔會從 `00:00:00` 開始計時；  
   * 最終成品則會輸出在 **主程式資料夾**，檔名格式為：  

     ```
     [您的影片名稱]_partial_時間.srt
     ```
     此檔案已自動校正時間，可直接與完整字幕 `[您的影片名稱].srt` 合併。
   * ⚠️ 建議局部轉錄片段 **不要超過 10 分鐘**。

   **★ 合併教學（以 Subtitle Edit 軟體為例）：**
   * 功能列 → 工具 → 合併字幕
   * 加入完整字幕檔與局部轉錄檔（使用主程式資料夾內的檔案，而非 temp 資料夾）
   * 選擇「已有正確時間」 → 合併即可
     ![imgur](https://imgur.com/IDUa8pu.jpg)

2. ⏱️ **SRT 時間反查工具**
   這是一個小型計算器，可以快速查詢「某個時間點的字幕，來自哪個分割音訊檔」。

   * 預設會自動代入下方設定的分割秒數
   
   * 也可手動修改分割時間，方便對照
   
     


## 🔑 關於 Google API Key

本工具需要 Google API Key 才能運作。
1.  **如何取得？** 請前往 [Google AI Studio](https://aistudio.google.com/app/apikey) 網站，登入您的 Google 帳號，右上角Create API Key→隨意選擇一個projects→即可建立免費的 API 金鑰→注意須馬上複製key，並且不要隨意告知他人。**Usage&Billing**裡面關注**Request Count per Day**，**注意每日要求數 (RPD)上限**，系統會在太平洋時間午夜重設。
2.  **費用**：Gemini API 提供免費的使用額度，對於一般用量的個人專案通常已經足夠。可觀看官方[頻率限制說明](https://ai.google.dev/gemini-api/docs/rate-limits?hl=zh-tw) ，**gemini-2.5-pro免費方案每日要求數 (RPD)上限為100**。**但是!!**不要每天用到極限，筆者用個幾天高額度就被限制不能用2.5-pro了，得過幾天都不用他才可再用2.5-pro模型  
          ![Imgur](https://imgur.com/yHftrR4.jpg)  



## ❓ 常見問題 (FAQ)

*   **Q: 程式點開閃退？**
    
    *   A: 請務必確認 `AI_TranslateSRT.exe` 和 `ffmpeg.exe` 在同一個資料夾下。其次，您的防毒軟體可能會誤判，請嘗試暫時停用或將本程式加入信任清單。
    
*   **Q: 日誌中出現 `API Key empty response` 錯誤？**
    
    * A: 可能原因有以下幾種：
    (1)該區塊沒有對話內容 → 屬於正常情況。  
    (2)API Key 暫時被限制 → 通常幾分鐘到一小時後會自動解除。  
    (3)Google 偵測異常流量並鎖定 → 即使換帳號，有時同一 IP 也會一起被鎖。  
    解決方式：
    ◆等待一段時間後再重試。  
    ◆嘗試更換帳號或 API Key。  
    ◆改用較低階模型（如 2.5-flash ）。  
    ◆若持續受限，可暫停幾天或考慮使用付費方案。
    
*    **Q: 剛開啟程式時下方參數無法更改？**
     
    * A: 先點選來源檔案，不論是否有真正選擇，下面參數皆能修改了。

## 額外補充：
1. **侷限**：以下幾種情境下，語音轉 SRT 的效果會比較差  
   (1) **唱歌或多人同時唱不同歌詞** → 容易漏詞，或時間軸不精準。  
   (2) **長時間無對白**（例如靜音、純音樂） → AI 可能產生「幻覺」隨意填詞，或字幕時間軸整段偏移。  
   (3) **收音品質不佳**（如環境雜音、聲音太小或模糊） → 可能造成部分字幕缺字或辨識錯誤。  
   建議處理方式：
   ​	◆若影片含長時間無對白，建議事先裁切該段落（常見於開場、休息時間或片尾幕後人員表）。
   ​	◆若無法裁切：
   - 可在轉錄完成後手動刪除幻覺字幕；
   - 對於完全無聲音的分割檔，可建立一個同名「空 SRT」檔（至少要有一行字幕，避免 0KB），以便程式跳過。
   ​	◆若字幕時間軸整體偏移，可嘗試：
   - 重新轉錄該段（看是否改善）；
   - 或使用字幕編輯軟體調整整段時間軸，再與其他字幕合併。（會比較快）

2. **prompt補充**：
   目前對於多義詞（例如英文 brother，中文可能是「哥哥」或「弟弟」）並沒有特別處理。若有需求，可以在主要規則中自行補充。例如：可到{sixth_priority}下方 添加 
```
對於兄弟姊妹、代名詞、敬語、顏色等多義詞，必須根據上下文推斷，若無法判斷，保留中性詞或加註說明。
```
並補充角色資料，例如：
```
[角色資料] 
John: 男, 年長於 Tom  
Tom: 男, 年幼於 John  
Alice: 女, 無兄弟姐妹資料 
```
⚠️ 所有新增內容請放在 {final_instruction} 之前。
（實際效果是否有幫助，還需要自行測試 😅）

​      

## 📝 To-Do List

- [ ] api key加密：GUI顯示遮罩、json加密

- [ ] **自訂義 URL 以及其 API Key**：可能得注意第三方公司是否能上傳檔案以及給予prompt

- [ ] **英文版介**面
  - [ ] 目前介面會調用指定列表裡繁中字體，都沒有會調用sans-serif。若非中文語系電腦是否會有問題(日誌區域、UI)？
  - [ ] 切換不同語言介面(建立語言檔案?)或者做兩版
- [ ] Srt校正規則改良：文文字與時間軸指空一格而非下一行的錯誤校正。目前是直接重做
- [ ] 重試的等待時間：好像被ai亂改了，要修回(基礎等待時間+隨機抖動0~15秒)
- [ ] 解決長時間無對白的一些問題：已試過VAD
  

